### 4.4. [C4 Level 2] مخطط الحاويات (Container Diagram)
#### 4.4.1. تعليمات إنشاء مخططات الحاويات (C4 Level 2) في PlantUML

##### 4.4.1.1. المفهوم والهدف
**مخطط الحاويات (Container Diagram)** - هو المخطط من المستوى الثاني في تدوين C4. يقوم بتفصيل **النظام** (من مخطط السياق)، موضحًا من أي وحدات قابلة للتنفيذ كبيرة (حاويات) يتكون وكيف تتفاعل.

*   **الجمهور:** المطورون، مهندسو DevOps، المهندسون المعماريون.
*   **الهدف:** الإجابة على الأسئلة: *"كيف يعمل النظام تحت الغطاء؟"*, *"من أي مكونات كبيرة يتكون؟"*, *"كيف تتواصل معًا؟"*.
*   **العناصر الرئيسية:** الحاويات (التطبيقات، قواعد البيانات)، العلاقات بينها والتقنيات الرئيسية.

حظر تحديد التقنيات المستخدمة: قبل تصميم المخططات، من الضروري التوضيح مع المستخدم مجموعة التقنيات المستخدمة في المشروع؛ إذا لم يتمكن المستخدم من تحديد المجموعة، فاستبعد الإشارة إلى مجموعة التقنيات على جميع مستويات مخططات C4.

إذا كان ملف المخطط موجودًا، فمن الضروري سؤال المستخدم عما إذا كان需要 تحديث الملف الحالي أو حفظ المخطط في ملف بالإصدار التالي.
##### 4.4.1.2. التركيب النحوي الأساسي لـ PlantUML لـ C4

لاستخدام تدوين C4 في PlantUML، من الضروري تضمين المكتبة المقابلة.
يجب أن يتوافق المخطط مع التركيب النحوي المحدد في https://github.com/plantuml-stdlib/C4-PlantUML

**سطر إلزامي في بداية النص البرمجي:**
plantuml
@startuml
!include <C4/C4_Container>
' كود المخطط الخاص بك هنا...
@enduml


##### 4.4.1.3. العناصر الأساسية وإعلانها

##### 4.4.1.3.1. النظام (توضيح السياق)
العنصر ذو المستوى الأعلى الذي نقوم بتفصيله.


System(alias, "label", "optional description")

*   `alias` - معرف فريد للعنصر (لاتيني، بدون مسافات).
*   `label` - الاسم المعروض.
*   `description` - وصف اختياري.

**مثال:**
plantuml
System(online_banking, "الخدمات المصرفية عبر الإنترنت", "يوفر للعملاء الوصول إلى حساباتهم ومعاملاتهم عبر الويب والجوال")


##### 4.4.1.3.2. الحاويات (Containers)
الكتل البنائية الرئيسية للمخطط. هذه هي عمليات/تطبيقات قابلة للتشغيل أو مخازن بيانات.

**تركيب الإعلان:**

Container(alias, "label", "technology", "optional description")

*   `technology` - إشارة إلى التقنية (على سبيل المثال، "React", "Spring Boot", "PostgreSQL").

**أنواع الحاويات:**
*   `Container()` - حاوية عالمية (تطبيق، خدمة).
*   `ContainerDb()` - حاوية لقاعدة البيانات.
*   `ContainerQueue()` - حاوية لقائمة انتظار الرسائل (وسيط).
*   `Container_Ext()` - حاوية خارجية (تديرها جهة خارجية).

**أمثلة:**
plantuml
Container(spa, "تطبيق الويب", "تطبيق Single-Page Application للعملاء")
ContainerDb(db, "قاعدة البيانات", "تخزن جميع البيانات المالية وتسجيلات دخول المستخدمين")
Container(backend_api, "Backend API", "يوفر REST API لعملاء الويب والجوال")
Container_Ext(email_service, "خدمة البريد الإلكتروني", "خدمة خارجية لإرسال الإشعارات")


##### 4.4.1.3.3. العلاقات (Relationships)
تظهر التفاعل بين الحاويات. تشير إلى البروتوكول أو تقنية التفاعل.

**التركيب النحوي:**

Rel(from, to, "label", "technology")

*   `from`, `to` - أسماء مستعارة للعناصر المرتبطة.
*   `label` - وصف التفاعل (على سبيل المثال، "يقرأ/يكتب").
*   `technology` - التقنية/البروتوكول (على سبيل المثال، "REST API", "JDBC", "Kafka").

**مثال:**
plantuml
Rel(spa, backend_api, "يستدعي API")
Rel(backend_api, db, "يقرأ/يكتب")
Rel(backend_api, email_service, "يرسل إشعارات")


#### 4.4.1.4. التجميع والحدود (Boundaries)
لإبراز أجزاء النظام التي تنتمي إلى مجالات أو فرق مختلفة، استخدم الحدود.

**التركيب النحوي:**

Boundary(alias, "label") {
    container1 = Container(...)
    container2 = Container(...)
    Rel(container1, container2, ...)
}


**مثال:**
plantuml
Boundary(boundary_backend, "مجال Backend") {
    Container(api_gateway, "API Gateway")
    Container(user_service, "User Service")
    Container(account_service, "Account Service")
    Rel(api_gateway, user_service, "يستدعي")
    Rel(api_gateway, account_service, "يستدعي")
}


#### 4.4.1.5. وسيلة الإيضاح (Legend)
للوثائق الرسمية، يوصى بإضافة وسيلة إيضاح تشرح عناصر المخطط.


SHOW_LEGEND()


#### 4.4.1.6. مثال كامل للمخطط

plantuml
@startuml
!include <C4/C4_Container>

Title "مخطط الحاويات - نظام الخدمات المصرفية عبر الإنترنت"

Person(customer, "العميل", "يستخدم الخدمات المصرفية عبر الإنترنت")

System_Boundary(online_banking_system, "الخدمات المصرفية عبر الإنترنت") {
    Container(spa, "تطبيق الويب","تطبيق Single-Page Application")
    Container(mobile_app, "تطبيق الجوال","تطبيق جوال أصلي")
    Container(backend_api, "Backend API", "خدمة منطق الأعمال الرئيسي")
    ContainerDb(db, "قاعدة البيانات",  "تخزن بيانات المستخدمين والمعاملات")
}

System_Ext(processing_system, "نظام الدفع", "نظام خارجي لمعالجة المدفوعات")

Rel(customer, spa, "يزور الموقع")
Rel(customer, mobile_app, "يستخدم التطبيق")
Rel(spa, backend_api, "يستدعي API")
Rel(mobile_app, backend_api, "يستدعي API")
Rel(backend_api, db, "يقرأ/يكتب")
Rel(backend_api, processing_system, "يرسل طلب دفع")

SHOW_LEGEND()
@enduml


#### 4.4.1.7. قائمة التحقق من جودة المخطط
قبل الحفظ، تحقق من المخطط:
1.  [ ] **تم تضمين التوجيه** `!include <C4/C4_Container>`
2.  [ ] **الأدوار** يجب أن تؤخذ في الاعتبار جميع أدوار المستخدم المحددة في الملفات الأخرى في هذا المخطط.
3.  [ ] **يوجد عنوان واضح** (`Title`).
4.  [ ] **جميع الحاويات** لا تحتوي على إشارة تقنية.
5.  [ ] **جميع العلاقات** موسومة (ما الإجراء الذي يتم تنفيذه بدون الإشارة إلى البروتوكول).
6.  [ ] **لا توجد تفاصيل زائدة** (لا حاجة لعرض جميع الخدمات المصغرة إذا كان هناك العشرات).
7.  [ ] **الأسماء المستعارة** للعناصر فريدة ومكتوبة باللاتينية.
8.  [ ] **تمت إضافة وسيلة الإيضاح** (`SHOW_LEGEND()`) للمنتجات الرسمية.
9.  [ ] **في حالة الهندسة المعمارية للخدمات المصغرة:** لا يجوز للخدمة إنشاء أكثر من قاعدة بيانات واحدة من نفس النوع.
10. [ ] **حظر تحديد التقنيات المستخدمة:** قبل تصميم المخططات، من الضروري التوضيح مع المستخدم مجموعة التقنيات المستخدمة في المشروع؛ إذا لم يتمكن المستخدم من تحديد المجموعة، فاستبعد الإشارة إلى مجموعة التقنيات على جميع مستويات مخططات C4.
11. [ ] **فحص أدوار المستخدمين** يجب أن يشير المخطط إلى جميع أدوار المستخدمين الموجودة في مخطط السياق (C4 Level 1).
12. [ ] **بعد الانتهاء** اسأل المستخدم عن المستندات الأخرى التي تحتاج إلى إنشاء أو تعديل، مع تزويده بقائمة.

**تنسيق اسم الملف:** `c4_Level_2_containers_diagram_[اسم المشروع]_v[رقم الإصدار (بدءًا من 1)].plantuml`

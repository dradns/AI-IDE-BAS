### 4.3. [C4 level 1] مخطط السياق (Context Diagram)
#### 4.3.1. تعليمات إنشاء مخطط السياق (C4 Level 1) في PlantUML
##### 4.3.1.1. المفهوم والهدف
**مخطط السياق (Context Diagram)** - هو المخطط ذو المستوى الأعلى (Level 1) في تدوين C4. يظهر النظام ككتلة كاملة وتفاعله مع العالم الخارجي.
**الجمهور:** جميع أصحاب المصلحة، بما في ذلك غير التقنيين (العملاء التجاريون، المديرون).
**الهدف:** الإجابة على الأسئلة: *"ماذا يفعل النظام؟"*, *"من يستخدمه؟"*, *"ما هي الأنظمة الخارجية التي يتفاعل معها؟"*
**العناصر الرئيسية:** النظام، الأشخاص/الأدوار (الممثلون)، الأنظمة الخارجية.
حظر تحديد التقنيات المستخدمة: قبل تصميم المخططات، من الضروري التوضيح مع المستخدم مجموعة التقنيات المستخدمة في المشروع؛ إذا لم يتمكن المستخدم من تحديد المجموعة، فاستبعد الإشارة إلى مجموعة التقنيات على جميع مستويات مخططات C4.
إذا كان ملف المخطط موجودًا، فمن الضروري سؤال المستخدم عما إذا كان需要 تحديث الملف الحالي أو حفظ المخطط في ملف بالإصدار التالي.
##### 4.3.1.2. التركيب النحوي الأساسي لـ PlantUML لـ C4
لاستخدام تدوين C4 في PlantUML، من الضروري تضمين المكتبة المقابلة.
**سطر إلزامي في بداية النص البرمجي:**
plantuml
@startuml
!include <C4/C4_Context>
' كود المخطط الخاص بك هنا...
@enduml

##### 4.3.1.3. العناصر الأساسية وإعلانها
###### 4.3.1.3.1. النظام (System)
العنصر المركزي في المخطط، الذي نقوم بتصميمه.

System(alias, "label", "optional description")

*   `alias` - معرف فريد للعنصر (لاتيني، بدون مسافات).
*   `label` - اسم النظام المعروض.
*   `description` - وصف موجز اختياري لغرض النظام.

**مثال:**
plantuml
System(system_a, "نظام إدارة الطلبات", "يعالج طلبات العملاء، يدير المستودع والتوصيل")

###### 4.3.1.3.2. الممثلون (People/Person)
الأشخاص أو الأدوار الذين يتفاعلون مع النظام.

Person(alias, "label", "optional description")

*   `alias` - معرف فريد.
*   `label` - اسم الدور/الشخص المعروض.

**مثال:**
plantuml
Person(customer, "العميل", "مشتري البضائع في المتجر الإلكتروني")
Person(admin, "المسؤول", "يدير البضائع ويتتبع الطلبات")

###### 4.3.1.3.3. الأنظمة الخارجية (External Systems)
أنظمة برمجية خارج نطاق سيطرة فريقك ولكن نظامك يتفاعل معها.

System_Ext(alias, "label", "optional description")

*   `alias` - معرف فريد.
*   `label` - اسم النظام الخارجي المعروض.
**مثال:**
plantuml
System_Ext(payment_gateway, "بوابة الدفع", "تعالج مدفوعات بطاقات الائتمان")
System_Ext(email_service, "خدمة إشعارات البريد الإلكتروني", "ترسل رسائل بريد إلكتروني للعملاء")

###### 4.3.1.3.4. العلاقات (Relationships)
تظهر التفاعل بين العناصر. تشير إلى طبيعة التفاعل.

**التركيب النحوي:**

Rel(from, to, "label", "technology")

*   `from`, `to` - أسماء مستعارة للعناصر المرتبطة.
*   `label` - وصف التفاعل (على سبيل المثال، "يشتري البضائع", "يتلقى إشعارات").
*   `technology` - إشارة اختيارية للتقنية/البروتوكول (على سبيل المثال، "Web UI", "REST API"). *غالبًا ما يتم حذفها في مخطط السياق.*

**مثال:**
plantuml
Rel(customer, system_a, "يشتري البضائع", "Web UI")
Rel(system_a, payment_gateway, "يبدأ الدفع", "REST API")
Rel(system_a, email_service, "يرسل بيانات للإشعار", "SMTP")
Rel(admin, system_a, "يدير البضائع", "Web UI")

##### 4.3.1.4. تجميع العناصر (Boundaries)
لإبراز البيئة الداخلية والخارجية بصريًا، يمكن استخدام الحدود.


Enterprise_Boundary(alias, "label") {
    ' عناصر داخل حدود المؤسسة
}


**مثال:**
plantuml
Enterprise_Boundary(enterprise_a, "شركتنا") {
    Person(admin, "المسؤول")
    System(system_a, "نظام إدارة الطلبات")
}
Enterprise_Boundary(enterprise_b, "الشريك") {
    System_Ext(payment_gateway, "بوابة الدفع")
}

##### 4.3.1.5. وسيلة الإيضاح (Legend)
للوثائق الرسمية، يوصى بإضافة وسيلة إيضاح.


SHOW_LEGEND()

##### 4.3.1.6. مثال كامل للمخطط

plantuml
@startuml
!include <C4/C4_Context>

Title مخطط السياق - نظام إدارة الطلبات

Person(customer, "العميل", "يشتري البضائع في المتجر الإلكتروني")
Person(admin, "المسؤول", "يدير الكتالوج والطلبات")

System(system_a, "نظام إدارة الطلبات", "يقبل ويعالج الطلبات، يدير المستودع")

System_Ext(payment_gateway, "بوابة الدفع", "تعالج مدفوعات البطاقات")
System_Ext(email_service, "خدمة البريد الإلكتروني", "ترسل إشعارات للعملاء")
System_Ext(erp_system, "نظام ERP", "يتلقى بيانات للمحاسبة")

Rel(customer, system_a, "يعرض الكتالوج، يشتري البضائع")
Rel(admin, system_a, "يدير البضائع ويتتبع الطلبات")
Rel(system_a, payment_gateway, "يبدأ الدفع", "REST API")
Rel(system_a, email_service, "يرسل بيانات للإشعارات", "SMTP")
Rel(system_a, erp_system, "يصدر بيانات المبيعات", "SFTP")

SHOW_LEGEND()

@enduml

##### 4.3.1.7. قائمة التحقق من جودة المخطط
قبل الحفظ، تحقق من المخطط:
1.  [ ] **تم تضمين التوجيه** `!include <C4/C4_Context>`
2.  [ ] **يوجد عنوان واضح** (`Title`).
3.  [ ] **نظام مركزي واحد فقط** (الذي تقوم بتصميمه).
4.  [ ] **تم عرض جميع المستخدمين الرئيسيين** (الممثلين) و **الأنظمة الخارجية**.
5.  [ ] **العلاقات** موسومة بلغة تجارية واضحة (ماذا تفعل، وليس كيف تم تنفيذها تقنيًا).
6.  [ ] **لا توجد تفاصيل تقنية** للهيكل الداخلي للنظام (هذه مهمة مخطط الحاويات).
7.  [ ] **الأسماء المستعارة** للعناصر فريدة ومكتوبة باللاتينية.
8.  [ ] **تمت إضافة وسيلة الإيضاح** (`SHOW_LEGEND()`) للمنتجات الرسمية.
9.  [ ] **بعد حفظ الملف** اسأل المستخدم عن المستندات الأخرى التي تحتاج إلى إنشاء أو تعديل، مع تزويده بقائمة.
**تنسيق اسم الملف:** `c4_Level_1_context_diagram_[اسم المشروع]_v[رقم الإصدار (بدءًا من 1)].plantuml`
#### 4.3.2 مقاييس الجودة
1. الاكتمال:
   * جميع الممثلين الرئيسيين حاضرون
   * التكاملات الرئيسية معكوسة
2. الاتساق:
   * الأسماء تتوافق مع المنتجات الأخرى
   * لا توجد تناقضات مع الواقع
3. الأهمية:
   * تم تحديد إصدار المخطط
   * يوجد تاريخ آخر تحديث
#### 4.3.3 التكامل مع المنتجات الأخرى
1. مع User Story:
   * يجب تنسيق الممثلين
   * السيناريوهات الرئيسية معكوسة
2. مع Component Diagram:
   * الأنظمة الخارجية مكررة
   * مستوى التفاصيل منسق
3. مع ERD:
   * قواعد البيانات الخارجية تتوافق مع الكيانات


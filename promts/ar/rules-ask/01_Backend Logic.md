### 4.3. ูุตู ููุทู backend
**ุชุนูููุงุช ููุตู ููุทู ุนูู ุงูููุฒุฉ (Backend Logic)**

#### 4.3.1. ุงููุญุชูู
1. [ูุงูุจ ูุตู ููุทู ุงูููุฒุฉ](#ูุงูุจ-ูุตู-ููุทู-ุงูููุฒุฉ)
2. [ููุงููุณ ุงูุฌูุฏุฉ](#ููุงููุณ-ุงูุฌูุฏุฉ)
3. [ููุงุนุฏ ุงูุชุญูู](#ููุงุนุฏ-ุงูุชุญูู)
4. [ูููุฌูุฉ ุงูุชุญููู](#ูููุฌูุฉ-ุงูุชุญููู)
5. [ุฃูุซูุฉ ูุตู ุงูููุทู](#ุฃูุซูุฉ-ูุตู-ุงูููุทู)
6. [ูุนุงููุฑ ุงูุฌูุฏุฉ](#ูุนุงููุฑ-ุงูุฌูุฏุฉ)
7. [ูุงุฆูุฉ ุงูุชุญูู ูุนุงูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู](#ูุงุฆูุฉ-ุงูุชุญูู-ูุนุงูู-ุงูุฐูุงุก-ุงูุงุตุทูุงุนู)

---

#### 4.3.2. ูุงูุจ ูุตู ููุทู ุงูููุฒุฉ

##### 4.3.2.1. ุงููููู ุงูุฅูุฒุงูู (8 ูุชู ุฑุฆูุณูุฉ):

| โ | ุงููุชูุฉ | ุงููุตู | ุงูุฅูุฒุงููุฉ |
|---|--------|-------|-----------|
| 1 | **ูุธุฑุฉ ุนุงูุฉ** | ุงูุบุฑุถ ูู ุงูููุฒุฉ ูุงูููุทู ุนุงูู ุงููุณุชูู | โ ุฅูุฒุงูู |
| 2 | **ุจูุงูุงุช ุงูุฅุฏุฎุงู** | ุงููุนุงููุงุชุ ุฃููุงุนูุงุ ุงููููุฏ | โ ุฅูุฒุงูู |
| 3 | **ุนูููุงุช ุงูุชุญูู** | ูุญูุตุงุช ุงูุจูุงูุงุชุ ููุงุนุฏ ุงูุฃุนูุงู | โ ุฅูุฒุงูู |
| 4 | **ุงูููุทู ุงูุฑุฆูุณู** | ุงูุฎูุงุฑุฒููุงุชุ ุงูุนูููุงุชุ ุงูุญุณุงุจุงุช | โ ุฅูุฒุงูู |
| 5 | **ุนูููุงุช ุงูุฏูุฌ** | ุงูุชูุงุนู ูุน ุงููุธู ุงูุฎุงุฑุฌูุฉ | โ ุฅูุฒุงูู |
| 6 | **ุงูููุงูู ุงูุงุณุชุซูุงุฆูุฉ** | ูุนุงูุฌุฉ ุงูุฃุฎุทุงุกุ ุงูุชุฑุงุฌุนุงุช | โ ุฅูุฒุงูู |
| 7 | **ุจูุงูุงุช ุงูุฅุฎุฑุงุฌ** | ูุชูุฌุฉ ุงูุนูููุฉุ ุชูุณููุงุช ุงูุฑุฏ | โ ุฅูุฒุงูู |
| 8 | **ุงูุฃุฏุงุก** | ุงูุชุญุณููุงุชุ ุงูุชุฎุฒูู ุงููุคูุชุ ุงููููุฏ | ๐ถ ููุตู ุจู |

---

#### 4.3.3. ููุงููุณ ุงูุฌูุฏุฉ

##### 4.3.3.1. ุงููุคุดุฑุงุช ุงููุณุชูุฏูุฉ:
- **ุงูุชูุงู ุงููููู**: 7/7 ูุชู ุฅูุฒุงููุฉ = 100%
- **ุชุบุทูุฉ ุงูุชุญูู**: ุงูุญุฏ ุงูุฃุฏูู 5 ุฃููุงุน ูุญุต ูุฎุชููุฉ
- **ุชูุตูู ุงูุฎูุงุฑุฒููุฉ**: ูุตู ุฎุทูุฉ ุจุฎุทูุฉ ูุน ุงูุดุฑูุท
- **ุชุบุทูุฉ ุงูุฃุฎุทุงุก**: ุงูุญุฏ ุงูุฃุฏูู 80% ูู ุงูุงุณุชุซูุงุกุงุช ุงููุญุชููุฉ
- **ุงุชุตุงู ุงูุชูุงูู**: 100% ุงูุชุซุงู ููููุฏุณุฉ ุงููุนูุงุฑูุฉ

##### 4.3.3.2. ูุธุงู ุงูุชูููู:
- **ุฌูุฏุฉ ููุชุงุฒุฉ**: 90-100% ุงูุชุซุงู ููููุงููุณ
- **ุฌูุฏุฉ ุฌูุฏุฉ**: 70-89% ุงูุชุซุงู ููููุงููุณ
- **ูุญุชุงุฌ ุชุญุณูู**: <70% ุงูุชุซุงู ููููุงููุณ

---

#### 4.3.4. ููุงุนุฏ ุงูุชุญูู

##### 4.3.4.1. ุงููุญูุตุงุช ุงูุชููุงุฆูุฉ:

###### 4.3.4.1.1. ุงูุชุญูู ุงูููููู

โ ุฌููุน ุงููุชู ุงูุฅูุฒุงููุฉ ุงูุณุจุนุฉ ููุฌูุฏุฉ
โ ูู ูุชูุฉ ุชุญุชูู ุนูู 3 ุนูุงุตุฑ ูุญุฏ ุฃุฏูู
โ ุนูููุงุช ุงูุชุญูู ููุธูุฉ ุญุณุจ ุงูุฃููุงุน
โ ุงูุฎูุงุฑุฒููุงุช ููุตููุฉ ุฎุทูุฉ ุจุฎุทูุฉ

###### 4.3.4.1.2. ุงูุชุญูู ุงูููุทูู

โ ุจูุงูุงุช ุงูุฅุฏุฎุงู ุชุชูุงูู ูุน ููุงุตูุงุช API
โ ุนูููุงุช ุงูุชุญูู ุชุบุทู ุฌููุน ูุนุงููุงุช ุงูุฅุฏุฎุงู
โ ุงูุฎูุงุฑุฒููุงุช ูุชุณูุณูุฉ ููุทููุงู
โ ุงูุงุณุชุซูุงุกุงุช ุชุชูุงูู ูุน ุงูุณููุงุฑูููุงุช ุงูุญููููุฉ

###### 4.3.4.1.3. ุงูุชุญูู ุงูุชูุงููู

โ ุนูููุงุช ุงูุฏูุฌ ุชุชูุงูู ูุน ุงููุฎุทุท ุงูููุฏุณู
โ ุนูููุงุช ุงูุชุญูู ููุณูุฉ ูุน Use Case
โ ุงูุฃุฎุทุงุก ุชุชูุงูู ูุน ุญุงูุงุช HTTP ูู API
โ ุงูุฃุฏุงุก ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุงููุชุทูุจุงุช ุบูุฑ ุงููุธูููุฉ

---

#### 4.3.5. ูููุฌูุฉ ุงูุชุญููู

##### 4.3.5.1. ุงูุฎุทูุฉ 1: ุฌูุน ุงูุจูุงูุงุช ุงููุตุฏุฑ
**ูุตุงุฏุฑ ุงูุชุญููู:**
- User Story ู Use Case
- ููุงุตูุงุช API (OpenAPI)
- ุงููุฎุทุท ุงูููุฏุณู
- ูุฎุทุท ERD
- ูุฎุทุทุงุช ุงูุชุณูุณู

##### 4.3.5.2. ุงูุฎุทูุฉ 2: ุชุญุฏูุฏ ุจูุงูุงุช ุงูุฅุฏุฎุงู
**ุชุญููู:**
- ูุนุงููุงุช ุงูุทูุจ ูู API spec
- ุญููู ุงูููุงุฐุฌ ูู User Story
- ุงูุจูุงูุงุช ูู ุงูุฎุฏูุงุช ุงูุฃุฎุฑู (ุนูููุงุช ุงูุฏูุฌ)
- ุงููุนูููุงุช ุงูุณูุงููุฉ (ุงููุณุชุฎุฏูุ ุงูุฌูุณุฉ)

##### 4.3.5.3. ุงูุฎุทูุฉ 3: ุชุนุฑูู ุนูููุงุช ุงูุชุญูู
**ุฃููุงุน ุงูุชุญูู:**
- **ุงููููููุฉ**: ููุน ุงูุจูุงูุงุชุ ุงูุชูุณููุ ุงูุทูู
- **ุชุญูู ุงูุฃุนูุงู**: ููุงุนุฏ ุงููุฌุงู
- **ุงูุฃูุงู**: ุงูุชูููุถุ ุญููู ุงููุตูู
- **ุงูุชูุงูู**: ูุญูุตุงุช ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ
- **ุงููููุฏ**: ุงูุญุฏูุฏุ ุงูุญุตุตุ ุงูููุงูุฐ ุงูุฒูููุฉ

##### 4.3.5.4. ุงูุฎุทูุฉ 4: ูุตู ุงูููุทู ุงูุฑุฆูุณู
**ุฃุณุงููุจ ุงูุชูุธูู:**
- ุงูุชูุณูู ุฅูู ูุฑุงุญู ููุทููุฉ
- ุงูุชูุฑุน ุงูุดุฑุทู (if-then-else)
- ุงูุนูููุงุช ุงูุฏูุฑูุฉ
- ุงูุนูููุงุช ุงููุชูุงุฒูุฉ
- ุงููุชู ุงููุนุงููุงุชูุฉ

##### 4.3.5.5. ุงูุฎุทูุฉ 5: ุชุญุฏูุฏ ุนูููุงุช ุงูุฏูุฌ
**ุชุญููู ุงูุชูุงุนู ูุน:**
- ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุนูููุงุช CRUD)
- ูุงุฌูุงุช API ุงูุฎุงุฑุฌูุฉ
- ููุงุฆู ุงูุงูุชุธุงุฑ
- ุฃูุธูุฉ ุงูุชุฎุฒูู ุงููุคูุช
- ุชุฎุฒูู ุงููููุงุช

##### 4.3.5.6. ุงูุฎุทูุฉ 6: ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
**ูุฆุงุช ุงูุงุณุชุซูุงุกุงุช:**
- ุฃุฎุทุงุก ุงูุชุญูู (400)
- ุงูุชูููุถ (401ุ 403)
- ุบูุฑ ููุฌูุฏ (404)
- ุงูุชุนุงุฑุถุงุช (409)
- ุฃุฎุทุงุก ุงูุฎุงุฏู (500)
- ุนุฏู ุชููุฑ ุงูุฎุฏูุงุช (503)

#### 4.3.6. ุฃูุซูุฉ ุนูู ูุตู ุงูููุทู

##### 4.3.6.1. ุงููุซุงู 1: ุงูุชุญููู ุงูุจููู

###### 4.3.6.1.1. ูุธุฑุฉ ุนุงูุฉ
**ุงูุบุฑุถ:** ูุนุงูุฌุฉ ุงูุชุญููู ุงูููุฏู ุจูู ุงูุญุณุงุจุงุช ูุน ุงูุชุญูู ูู ุงูุญุฏูุฏ ูุญูุธ ุงูุณุฌู ุงูุชุงุฑูุฎู.
**ุงูููุทู ุนุงูู ุงููุณุชูู:** ุงูุชุญูู โ ุงูุชุญูู ูู ุงูุญุฏูุฏ โ ุชุฌููุฏ ุงูุฃููุงู โ ุชูููุฐ ุงูุชุญููู โ ุงูุฅุดุนุงุฑุงุช

###### 4.3.6.1.2. ุจูุงูุงุช ุงูุฅุฏุฎุงู
typescript
interface TransferRequest {
  fromAccountId: string;     // UUID ุญุณุงุจ ุงููุฑุณู
  toAccountId: string;       // UUID ุญุณุงุจ ุงููุณุชูู
  amount: number;            // ุงููุจูุบ (ุฑูู ููุฌุจุ ุญุชู ููุฒูุชูู ุนุดุฑูุชูู)
  currency: string;          // ุฑูุฒ ุงูุนููุฉ (ISO 4217ุ 3 ุฃุญุฑู)
  comment?: string;          // ุชุนููู (ุญุชู 200 ุญุฑู)
  userId: string;            // UUID ุงููุณุชุฎุฏู ูู ุงูุฑูุฒ ุงููููุฒ (token)
}


###### 4.3.6.1.3. ุนูููุงุช ุงูุชุญูู
**3.1. ุนูููุงุช ุงูุชุญูู ุงููููููุฉ:**
- `amount` > 0 ู <= 999999.99
- `fromAccountId` ู `toAccountId` - UUID ุตุงูุญุงู
- `currency` - ููุฌูุฏ ูู ุณุฌู ุงูุนููุงุช
- `comment` - ูุง ูุญุชูู ุนูู ุฃุญุฑู ูุญุธูุฑุฉ (<, >, &, ")

**3.2. ุนูููุงุช ุงูุชุญูู ุงูุชุฌุงุฑูุฉ:**
- ุงููุณุชุฎุฏู ูู ูุงูู ุญุณุงุจ `fromAccountId`
- ุญุณุงุจ ุงููุฑุณู ูุดุท (status = 'ACTIVE')
- ุญุณุงุจ ุงููุณุชูู ููุฌูุฏ ููุดุท
- ุนููุฉ ุงูุญุณุงุจุงุช ุชุทุงุจู ุนููุฉ ุงูุชุญููู
- ููุงู ุฑุตูุฏ ูุงู ูู ุงูุญุณุงุจ (ุงูุฑุตูุฏ >= amount + ุงูุนูููุฉ)

**3.3. ุนูููุงุช ุงูุชุญูู ูู ุงูุญุฏูุฏ:**
- ูู ูุชู ุชุฌุงูุฒ ุงูุญุฏ ุงููููู
- ูู ูุชู ุชุฌุงูุฒ ุงูุญุฏ ุงูุดูุฑู
- ุนุฏุฏ ุงูุนูููุงุช ูู ุงูููู <= ุงูุญุฏ ุงูุฃูุตู ุงููุณููุญ

###### 4.3.6.1.4. ุงูููุทู ุงูุฃุณุงุณู
**ุงูุฎุทูุฉ 1: ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุญุณุงุจุงุช**
sql
SELECT id, balance, currency, status, daily_limit, monthly_limit
FROM accounts
WHERE id IN (fromAccountId, toAccountId)


**ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุญุฏูุฏ ุงูููููุฉ**
sql
SELECT SUM(amount) as daily_spent
FROM transfers
WHERE from_account_id = fromAccountId
  AND created_at >= CURRENT_DATE


**ุงูุฎุทูุฉ 3: ุญุณุงุจ ุงูุนูููุฉ**
javascript
function calculateFee(amount, fromAccount, toAccount) {
  if (fromAccount.bank_id === toAccount.bank_id) {
    return 0; // ุชุญููู ุฏุงุฎู ุงูุจูู
  }
  return Math.min(amount * 0.015, 100); // 1.5%ุ ุจุญุฏ ุฃูุตู 100
}


**ุงูุฎุทูุฉ 4: ุฅูุดุงุก ุงููุนุงููุฉ**
sql
BEGIN TRANSACTION;

-- ุชุฌููุฏ ุงูุฃููุงู
UPDATE accounts
SET balance = balance - (amount + fee),
    reserved = reserved + (amount + fee)
WHERE id = fromAccountId;

-- ุฅูุดุงุก ุณุฌู ุงูุชุญููู
INSERT INTO transfers (id, from_account_id, to_account_id, amount, fee, status)
VALUES (uuid(), fromAccountId, toAccountId, amount, fee, 'PROCESSING');

COMMIT;


**ุงูุฎุทูุฉ 5: ุชูููุฐ ุงูุชุญููู**
sql
BEGIN TRANSACTION;

-- ุงูุฎุตู ูู ุงููุฑุณู
UPDATE accounts
SET reserved = reserved - (amount + fee)
WHERE id = fromAccountId;

-- ุงูุฅุถุงูุฉ ูููุณุชูู
UPDATE accounts
SET balance = balance + amount
WHERE id = toAccountId;

-- ุชุญุฏูุซ ุงูุญุงูุฉ
UPDATE transfers
SET status = 'COMPLETED', completed_at = NOW()
WHERE id = transferId;

COMMIT;


###### 4.3.6.1.5. ุงูุชูุงููุงุช
**5.1. ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- ุงููุฑุงุกุฉ: accounts, transfer_limits, exchange_rates
- ุงููุชุงุจุฉ: transfers, account_transactions

**5.2. ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ:**
- **NotificationService**: ุฅุฑุณุงู ุฅุดุนุงุฑุงุช SMS/push
- **AuditService**: ุชุณุฌูู ุงูุนูููุงุช
- **FraudService**: ุงูุชุญูู ูู ุงูุงุญุชูุงู

**5.3. ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ (Redis):**
- ุญุฏูุฏ ุงููุณุชุฎุฏู (TTL: 24 ุณุงุนุฉ)
- ุฃุณุนุงุฑ ุงูุตุฑู (TTL: 1 ุณุงุนุฉ)

###### 4.3.6.1.6. ุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ
**6.1. ุฃุฎุทุงุก ุงูุชุญูู (400):**
- ูุจูุบ ุบูุฑ ุตุญูุญ โ "ูุฌุจ ุฃู ูููู ุงููุจูุบ ุฃูุจุฑ ูู 0"
- ุฃููุงู ุบูุฑ ูุงููุฉ โ "ุฃููุงู ุบูุฑ ูุงููุฉ ูู ุงูุญุณุงุจ"
- ุชุฌุงูุฒ ุงูุญุฏ โ "ุชู ุชุฌุงูุฒ ุงูุญุฏ ุงููููู ููุชุญูููุงุช"

**6.2. ุฃุฎุทุงุก ุงูุชูููุถ (403):**
- ููุณ ูุงูู ุงูุญุณุงุจ โ "ูุง ููุฌุฏ ูุตูู ููุฐุง ุงูุญุณุงุจ"
- ุญุณุงุจ ูุญุธูุฑ โ "ุงูุญุณุงุจ ูุญุธูุฑ"

**6.3. ุฃุฎุทุงุก ุงูุฎุงุฏู (500):**
- ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช โ ุงูุชุฑุงุฌุน ุนู ุงููุนุงููุฉ + ูุญุงููุฉ ูุฑุฉ ุฃุฎุฑู
- ุนุฏู ุชููุฑ ุฎุฏูุฉ ุฎุงุฑุฌูุฉ โ ูุนุงูุฌุฉ ูุคุฌูุฉ

**6.4. ุงุณุชุฑุงุชูุฌูุงุช ุงูุงุณุชุนุงุฏุฉ:**
- **ุงูุชุฑุงุฌุน ุนู ุงููุนุงููุงุช**: rollback ุชููุงุฆู ุนูุฏ ุงูุฃุฎุทุงุก
- **ุนูููุงุช ุงูุชุนููุถ**: ุฅูุบุงุก ุงูุชุฌููุฏ ุนูุฏ ุงูุฎุทุฃ
- **ุงููุญุงููุงุช ุงููุชูุฑุฑุฉ**: ุญุชู 3 ูุฑุงุช ูุน ุชุฃุฎูุฑ ุฃุณู (exponential backoff)

###### 4.3.6.1.7. ุจูุงูุงุช ุงูุฅุฎุฑุงุฌ
**7.1. ุฑุฏ ุงููุฌุงุญ (201):**
json
{
  "transferId": "uuid",
  "status": "COMPLETED",
  "amount": 1000.00,
  "fee": 0.00,
  "fromAccount": "xxx-1234",
  "toAccount": "xxx-5678",
  "timestamp": "2024-01-15T10:30:00Z"
}


**7.2. ุฎุทุฃ ูู ุงูุชุญูู (400):**
json
{
  "error": "VALIDATION_ERROR",
  "message": "ุฃููุงู ุบูุฑ ูุงููุฉ ูู ุงูุญุณุงุจ",
  "details": {
    "field": "amount",
    "available": 500.00,
    "requested": 1000.00
  }
}


###### 4.3.6.1.8. ุงูุฃุฏุงุก
**8.1. ุงูุชุญุณููุงุช:**
- ููุงุฑุณ ุนูู (from_account_id, created_at) ููุญุฏูุฏ
- ุชุฎุฒูู ุญุฏูุฏ ุงููุณุชุฎุฏู ูุคูุชูุง
- ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุบูุฑ ูุชุฒุงูู (asynchronous)

**8.2. ุงููููุฏ:**
- ุฃูุตู ุญูู: 1000 ุชุญููู/ุงูุซุงููุฉ
- ููุช ุงูุงุณุชุฌุงุจุฉ: < 2 ุซุงููุฉ (ุงููุณูู ุงููุฆูู 99)
- ุงูุชููุฑ: 99.9%

---

##### 4.3.6.2. ุงููุซุงู 2: ุฅูุดุงุก ุทูุจ ูู ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ

###### 4.3.6.2.1. ูุธุฑุฉ ุนุงูุฉ
**ุงูุบุฑุถ:** ุฅูุดุงุก ุทูุจ ูุน ุชุฌููุฏ ุงูุจุถุงุฆุนุ ูุญุณุงุจ ุงูุชูููุฉุ ูุจุฏุก ุนูููุฉ ุงูุชูุตูู.
**ุงูููุทู ุนุงูู ุงููุณุชูู:** ุงูุชุญูู ูู ุณูุฉ ุงูุชุณูู โ ุชุฌููุฏ ุงูุจุถุงุฆุน โ ุญุณุงุจ ุงูุชูููุฉ โ ุฅูุดุงุก ุงูุทูุจ โ ุจุฏุก ุงูุฏูุน

###### 4.3.6.2.2. ุจูุงูุงุช ุงูุฅุฏุฎุงู
typescript
interface CreateOrderRequest {
  items: OrderItem[];        // ุงูุจุถุงุฆุน ูู ุงูุทูุจ
  deliveryAddress: Address;  // ุนููุงู ุงูุชูุตูู
  paymentMethod: string;     // ุทุฑููุฉ ุงูุฏูุน
  promoCode?: string;        // ุฑูุฒ ุชุฑููุฌู
  userId: string;            // ูุนุฑู ุงููุณุชุฎุฏู
}

interface OrderItem {
  productId: string;    // UUID ุงูููุชุฌ
  quantity: number;     // ุงููููุฉ (1-100)
  variant?: string;     // ููุน ุงูููุชุฌ (ููุงุณุ ููู)
}


###### 4.3.6.2.3. ุนูููุงุช ุงูุชุญูู
**3.1. ุนูููุงุช ุงูุชุญูู ุงููููููุฉ:**
- `items` ุชุญุชูู ุนูู 1 ุฅูู 50 ุนูุตุฑ
- `quantity` ููู ููุชุฌ ูู 1 ุฅูู 100
- `deliveryAddress` ูุญุชูู ุนูู ุฌููุน ุงูุญููู ุงูุฅูุฒุงููุฉ
- `paymentMethod` ูู ุงููุงุฆูุฉ ุงููุณููุญ ุจูุง

**3.2. ุนูููุงุช ุงูุชุญูู ุงูุชุฌุงุฑูุฉ:**
- ุฌููุน ุงูููุชุฌุงุช ููุฌูุฏุฉ ููุชุงุญุฉ ููุจูุน
- ูููุฉ ูุงููุฉ ูู ุงููุณุชูุฏุน
- ูููู ุชูุตูู ุงูููุชุฌุงุช ุฅูู ุงูุนููุงู ุงููุญุฏุฏ
- ุงูุฑูุฒ ุงูุชุฑููุฌู ุณุงุฑู ุงูููุนูู ููุงุจู ููุชุทุจูู

**3.3. ุนูููุงุช ุชุญูู ุงููุณุชุฎุฏู:**
- ุงููุณุชุฎุฏู ูุดุท ูุบูุฑ ูุญุธูุฑ
- ุนููุงู ุงูุชูุตูู ูุฎุต ุงููุณุชุฎุฏู
- ุทุฑููุฉ ุงูุฏูุน ูุฑุชุจุทุฉ ุจุงููุณุชุฎุฏู

###### 4.3.6.2.4. ุงูููุทู ุงูุฃุณุงุณู
**ุงูุฎุทูุฉ 1: ุงูุชุญูู ูู ุชููุฑ ุงูุจุถุงุฆุน**
sql
SELECT p.id, p.name, p.price, s.quantity as stock_quantity
FROM products p
JOIN stock s ON p.id = s.product_id
WHERE p.id IN (...) AND p.status = 'ACTIVE'


**ุงูุฎุทูุฉ 2: ุชุฌููุฏ ุงูุจุถุงุฆุน**
sql
BEGIN TRANSACTION;

UPDATE stock
SET quantity = quantity - reserved_quantity,
    reserved = reserved + reserved_quantity
WHERE product_id = ? AND quantity >= reserved_quantity;

-- ุงูุชุญูู ูู ูุฌุงุญ ุงูุชุฌููุฏ
IF @@ROWCOUNT = 0 THEN
  ROLLBACK;
  THROW 'ูุง ุชูุฌุฏ ูููุฉ ูุงููุฉ ูู ุงูููุชุฌ ูู ุงููุณุชูุฏุน';
END IF;

COMMIT;


**ุงูุฎุทูุฉ 3: ุญุณุงุจ ุงูุชูููุฉ**
javascript
function calculateOrderTotal(items, deliveryAddress, promoCode) {
  let itemsTotal = items.reduce((sum, item) =>
    sum + (item.price * item.quantity), 0);

  let deliveryFee = calculateDeliveryFee(deliveryAddress, itemsTotal);
  let discount = applyPromoCode(promoCode, itemsTotal);

  return {
    itemsTotal,
    deliveryFee,
    discount,
    total: itemsTotal + deliveryFee - discount
  };
}


**ุงูุฎุทูุฉ 4: ุฅูุดุงุก ุงูุทูุจ**
sql
INSERT INTO orders (id, user_id, status, items_total, delivery_fee,
                   discount, total, delivery_address, created_at)
VALUES (?, ?, 'PENDING', ?, ?, ?, ?, ?, NOW());

INSERT INTO order_items (order_id, product_id, quantity, price)
VALUES (...);


###### 4.3.6.2.5. ุงูุชูุงููุงุช
**5.1. ุงูุฎุฏูุงุช ุงูุฌุฒุฆูุฉ (Microservices):**
- **InventoryService**: ุงูุชุญูู ูู ุงูุจุถุงุฆุน ูุชุฌููุฏูุง
- **PricingService**: ุญุณุงุจ ุงูุฎุตููุงุช ูุงูุฃุณุนุงุฑ
- **DeliveryService**: ุญุณุงุจ ุชูููุฉ ุงูุชูุตูู
- **PaymentService**: ุจุฏุก ุงูุฏูุน
- **NotificationService**: ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู

**5.2. ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- ุงููุฑุงุกุฉ: products, stock, users, promo_codes
- ุงููุชุงุจุฉ: orders, order_items, stock_reservations

###### 4.3.6.2.6. ุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ
**6.1. ุนุฏู ุชููุฑ ุงูููุชุฌ (409):**
- ููุงุฏ ุงูููุชุฌ โ ุงูุชุฑุงุญ ุจุฏุงุฆู
- ุงูููุชุฌ ุบูุฑ ูุชุงุญ ููุจูุน โ ุฅุฒุงูุชู ูู ุณูุฉ ุงูุชุณูู

**6.2. ุฃุฎุทุงุก ุงูุชูุงูู (503):**
- ุนุฏู ุชููุฑ InventoryService โ ูุญุงููุฉ ูุฑุฉ ุฃุฎุฑู
- ุฎุทุฃ ูู PaymentService โ ุญูุธ ุงูุทูุจ ูู DRAFT

**6.3. ุนูููุงุช ุงูุชุนููุถ:**
- ุฅูุบุงุก ุงูุชุฌููุฏ ุนูุฏ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุทูุจ
- ุงุณุชุฑุฏุงุฏ ุงูุฃููุงู ุนูุฏ ุฅูุบุงุก ุงูุทูุจ

###### 4.3.6.2.7. ุจูุงูุงุช ุงูุฅุฎุฑุงุฌ
**ุฑุฏ ุงููุฌุงุญ:**
json
{
  "orderId": "ord_123456",
  "status": "PENDING",
  "total": 2500.00,
  "paymentUrl": "https://payment.service/pay/...",
  "estimatedDelivery": "2024-01-20"
}


###### 4.3.6.2.8. ุงูุฃุฏุงุก
**ุงูุชุญุณููุงุช:**
- ุชุฎุฒูู ุฃุณุนุงุฑ ุงูููุชุฌุงุช ูุคูุชูุง (TTL: 1 ุณุงุนุฉ)
- ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุบูุฑ ูุชุฒุงูู
- ุชุฌููุน ุงุณุชุนูุงูุงุช SQL

---

#### 4.3.7. ูุนุงููุฑ ุงูุฌูุฏุฉ ููุฐูุงุก ุงูุงุตุทูุงุนู

##### 4.3.7.1. ุงูุชูุงู ุงููุตู
- **ุฅูุฒุงูู**: ุฌููุน ุงููุชู ุงูุฃุณุงุณูุฉ ุงูุณุจุนุฉ ููููุกุฉ
- **ููุตู ุจู**: ุฅุถุงูุฉ ูุชูุฉ ุงูุฃุฏุงุก
- **ุงูุชูุตูู**: ูู ูุชูุฉ ุชุญุชูู ุนูู 3 ููุงุท ูุญุฏ ุฃุฏูู

##### 4.3.7.2. ุงูุฏูุฉ ุงูุชูููุฉ
- **ุนูููุงุช ุงูุชุญูู**: ุชุบุทู ุฌููุน ูุนุงููุงุช ุงูุฅุฏุฎุงู
- **ุงูุฎูุงุฑุฒููุงุช**: ููุตููุฉ ุฎุทูุฉ ุจุฎุทูุฉ ูุน ุฃูุซูุฉ ููุฏ/SQL
- **ุงูุชูุงููุงุช**: ุชุชูุงูู ูุน ุจููุฉ ุงููุธุงู
- **ุงูุฃุฎุทุงุก**: ุชุชุถูู ุญุงูุงุช HTTP ูุงุณุชุฑุงุชูุฌูุงุช ุงูุงุณุชุนุงุฏุฉ

##### 4.3.7.3. ุงูุชุฑุงุจุท ูุน ุงูุจููุฉ
- **API**: ูุชูุงูู ูุน ููุงุตูุงุช OpenAPI
- **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ูุณุชุฎุฏู ุงูููุงูุงุช ูู ERD
- **ุงูุฎุฏูุงุช**: ุชุฐูุฑ ุงูููููุงุช ูู ูุฎุทุท ุงูุจููุฉ
- **ุงูุชุฏููุงุช**: ุชุชูุงูู ูุน ูุฎุทุทุงุช ุงูุชุณูุณู (sequence diagrams)

##### 4.3.7.4. ุงููุงุจููุฉ ููุชุทุจูู ุงูุนููู
- **ุงููุงุจููุฉ ููุชูููุฐ**: ูููู ุชูููุฐ ุงูุฎูุงุฑุฒููุงุช ูู ุงูููุฏ
- **ุงูุฃุฏุงุก**: ุชู ุฃุฎุฐ ุงููููุฏ ูุงูุชุญุณููุงุช ูู ุงูุงุนุชุจุงุฑ
- **ุงูุฃูุงู**: ุชู ูุตู ุนูููุงุช ุงูุชุญูู ูู ุงูุชูููุถ
- **ุงููุฑุงูุจุฉ**: ุชู ุฐูุฑ ุงูููุงููุณ ูุงูุชุณุฌูู

---

#### 4.3.8. ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ ููููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู

##### 4.3.8.1. ุงูุชุญูู ุงูุฅูุฒุงูู:
- [ ] โ ุฌููุน ุงููุชู ุงูุฅูุฒุงููุฉ ุงูุณุจุนุฉ ููุฌูุฏุฉ
- [ ] โ ุจูุงูุงุช ุงูุฅุฏุฎุงู ุชุชูุงูู ูุน ููุงุตูุงุช API
- [ ] โ ุนูููุงุช ุงูุชุญูู ุชุบุทู ุฌููุน ุงููุนุงููุงุช (ูููููุฉ + ุชุฌุงุฑูุฉ)
- [ ] โ ุงูููุทู ุงูุฃุณุงุณู ููุณู ุฅูู ุฎุทูุงุช ูุงุถุญุฉ
- [ ] โ ุงูุชูุงููุงุช ุชุชูุงูู ูุน ูุฎุทุท ุงูุจููุฉ
- [ ] โ ุชู ูุตู ูุนุงูุฌุฉ 5 ุฃููุงุน ุนูู ุงูุฃูู ูู ุงูุฃุฎุทุงุก
- [ ] โ ุจูุงูุงุช ุงูุฅุฎุฑุงุฌ ุชุชุถูู ุฃูุซูุฉ JSON
- [ ] โ ุชู ุงุณุชุฎุฏุงู ุฃูุซูุฉ ููุฏ/SQL ููููุทู ุงููุนูุฏ

##### 4.3.8.2. ุงูุชุญูู ุงูููุนู:
- [ ] ๐ฏ ุงูุฎูุงุฑุฒููุงุช ูุชุณูุณูุฉ ููุทูููุง
- [ ] ๐ฏ ุนูููุงุช ุงูุชุญูู ูุงูุนูุฉ ููุฌุงู ุงูุชุทุจูู
- [ ] ๐ฏ ุงูุฃุฎุทุงุก ุชุชุถูู ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู
- [ ] ๐ฏ ุงูุฃุฏุงุก ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุงููุชุทูุจุงุช ุบูุฑ ุงููุธูููุฉ
- [ ] ๐ฏ ุงูุฃูุงู ูุชุถูู ุงูุชูููุถ ูุงูุชุฏููู
- [ ] ๐ฏ ุงูุชูุงููุงุช ุชุชุถูู ูุนุงูุฌุฉ ุงูุฃุนุทุงู

##### 4.3.8.3. ุงูุชุญูู ุงูุฅุถุงูู:
- [ ] ๐ ุฃูุซูุฉ ุงูููุฏ ุตุญูุญุฉ ูุญูููุง
- [ ] ๐ ุงุณุชุนูุงูุงุช SQL ูุงุจูุฉ ููุชูููุฐ (ุฃุณูุงุก ุฌุฏุงูู/ุญููู ุตุญูุญุฉ)
- [ ] ๐ ุญุงูุงุช HTTP ุชุชูุงูู ูุน ุฃููุงุน ุงูุฃุฎุทุงุก
- [ ] ๐ ุงููููุฏ ุงูุฒูููุฉ ูุงูุนูุฉ
- [ ] ๐ ุฃุญุฌุงู ุงูุจูุงูุงุช ุชุชูุงูู ูุน ูุทุงู ุงููุธุงู

**ุงููุฏู**: ุฅูุดุงุก ุฃูุตุงู ููุทููุฉ ุฌุงูุฒุฉ ูุชุณููููุง ููุฑูู ุงูุชุทููุฑ ุฏูู ุชูุถูุญุงุช ุฅุถุงููุฉ ููุงุจูุฉ ููุชูููุฐ ุจุงููุงูู ูู ุงูููุฏ.

---

#### 4.3.9. ุชูุตูุงุช ุฅุถุงููุฉ

##### 4.3.9.1. ุฃุณููุจ ุงููุชุงุจุฉ:
- **ุงูุจููุฉ**: ุงุณุชุฎุฏุงู ุงูููุงุฆู ุงููุฑููุฉ ูุงูุนูุงููู ุงููุฑุนูุฉ
- **ุงูุชุญุฏูุฏ**: ุชุฌูุจ ุงูุตูุบ ุงููุฌุฑุฏุฉ
- **ุงูุฃูุซูุฉ**: ุชุถููู ุงูููุฏุ SQLุ JSON ููุชูุถูุญ
- **ุงููุงุจููุฉ ููููุงุณ**: ุชุญุฏูุฏ ุฃุฑูุงู ููููุฏ ูุญุฏุฏุฉ

##### 4.3.9.2. ุงูุชูุงุตูู ุงูุชูููุฉ:
- **ุฃููุงุน ุงูุจูุงูุงุช**: ุญุฏุฏ ุฃููุงุน ุงููุนุงููุงุช ุจุดูู ุตุฑูุญ
- **ุงูุชูุณููุงุช**: ุตูุบ ุชูุณููุงุช ุงูุชูุงุฑูุฎุ ุงูุฃุฑูุงูุ ุงูุณูุงุณู
- **ุงููููุฏ**: ุญุฏุฏ ุงูููู ุงูุฏููุง/ุงููุตูู
- **ุงูุฃุฏุงุก**: ุฃุถู ูุนูููุงุช ุนู ุงูุญูู

##### 4.3.9.3. ุงูุชูุงูู ูุน ุงููุทุน ุงูุฃุซุฑูุฉ ุงูุฃุฎุฑู:
- **ุญุงูุฉ ุงูุงุณุชุฎุฏุงู (Use Case)**: ูุฌุจ ุฃู ูุบุทู ุงูููุทู ุฌููุน ุงูุณููุงุฑูููุงุช
- **API**: ูุฌุจ ุฃู ุชุชุทุงุจู ุงููุนุงููุงุช ูุงูุฑุฏูุฏ
- **ERD**: ุงุณุชุฎุฏุงู ุฃุณูุงุก ุงูุฌุฏุงูู ูุงูุญููู ุงูุตุญูุญุฉ
- **ุงูุจููุฉ**: ุฐูุฑ ุงูููููุงุช ุงูุญุงููุฉ

